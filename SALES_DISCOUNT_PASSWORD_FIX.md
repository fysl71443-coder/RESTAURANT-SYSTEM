# ๐ง Sales System Discount & Password Protection Fix

## โ **ุงููุดุงูู ุงูุชู ุชู ุฅุตูุงุญูุง:**

### 1. **ุฅุตูุงุญ ูุดููุฉ ุนุฏู ุธููุฑ ุงูุฎุตู ูู ุงููุงุชูุฑุฉ**

#### ุฃ) ุชุญุณูู ุนุฑุถ ุงูุฎุตู ูู ุงูุฅูุตุงู ุงููุทุจูุน:
**File**: `templates/print/receipt.html`
- โ ุฅุถุงูุฉ ูุต ุนุฑุจู ููุนูุงููู
- โ ุฅุธูุงุฑ ุงูุฎุตู ููุท ุฅุฐุง ูุงู ุฃูุจุฑ ูู ุตูุฑ
- โ ุนุฑุถ ุงูุฎุตู ุจููู ุฃุญูุฑ ูุน ุนูุงูุฉ ูุงูุต (-)
- โ ุชุญุณูู ุชูุณูู ุงูุฅุฌูุงูู ุงูููุงุฆู

```html
<!-- ูุจู ุงูุฅุตูุงุญ -->
<tr class="total-row"><td colspan="3">Discount</td><td class="right">0.00</td></tr>

<!-- ุจุนุฏ ุงูุฅุตูุงุญ -->
{% if inv.discount_amount and inv.discount_amount > 0 %}
<tr class="total-row" style="color: #d63384;">
  <td colspan="3">{{ _('Discount / ุงูุฎุตู') }}</td>
  <td class="right">-{{ '%.2f'|format(inv.discount_amount) }}</td>
</tr>
{% endif %}
```

#### ุจ) ุชุญุณูู ุนุฑุถ ุงูุฎุตู ูู ุฌุฏูู ุงูููุงุชูุฑ:
**File**: `templates/sales.html`
- โ ุฅุถุงูุฉ ุนููุฏ "Discount / ุงูุฎุตู" ูู ุฌุฏูู ุงูููุงุชูุฑ
- โ ุนุฑุถ ูููุฉ ุงูุฎุตู ุจููู ุฃุญูุฑ ูุน ุนูุงูุฉ ูุงูุต
- โ ุฅุธูุงุฑ "-" ุฅุฐุง ูู ููู ููุงู ุฎุตู

### 2. **ุฅุถุงูุฉ ุญูุงูุฉ ูููุฉ ุงูุณุฑ ูุฅูุบุงุก ุงูููุงุชูุฑ**

#### ุฃ) ุชุญุฏูุซ API endpoint ููุชุญูู ูู ูููุฉ ุงูุณุฑ:
**File**: `app.py` - `api_sales_void_check()`
- โ ุชุบููุฑ ูููุฉ ุงูุณุฑ ุงูุซุงุจุชุฉ ุฅูู: **1991**
- โ ุชุญุณูู ุฑุณุงูุฉ ุงูุฎุทุฃ ุจุงููุบุชูู ุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ

```python
# ูุจู ุงูุฅุตูุงุญ - ูููุฉ ุณุฑ ูุชุบูุฑุฉ ูู ุงูุฅุนุฏุงุฏุงุช
expected = settings.void_password or settings.tax_number or '0000'

# ุจุนุฏ ุงูุฅุตูุงุญ - ูููุฉ ุณุฑ ุซุงุจุชุฉ
expected = '1991'
```

#### ุจ) ุฅุถุงูุฉ ุญูุงูุฉ ูููุฉ ุงูุณุฑ ูุญุฐู ุงูููุงุชูุฑ:
**File**: `app.py` - `delete_sales_invoice()`
- โ ุงูุชุญูู ูู ูููุฉ ุงูุณุฑ **1991** ูุจู ุงูุญุฐู
- โ ุฑุณุงูุฉ ุฎุทุฃ ูุงุถุญุฉ ุฅุฐุง ูุงูุช ูููุฉ ุงูุณุฑ ุฎุงุทุฆุฉ

#### ุฌ) ุชุญุฏูุซ JavaScript ูุทูุจ ูููุฉ ุงูุณุฑ:
**File**: `templates/sales.html` - `deleteSalesInvoice()`
- โ ุทูุจ ูููุฉ ุงูุณุฑ ูุจู ุญุฐู ุงููุงุชูุฑุฉ
- โ ุงูุชุญูู ูู ุฃู ูููุฉ ุงูุณุฑ ุบูุฑ ูุงุฑุบุฉ
- โ ุฅุฑุณุงู ูููุฉ ุงูุณุฑ ูุน ุทูุจ ุงูุญุฐู

**File**: `templates/sales_table_invoice.html` - `voidInvoice()`
- โ ุชุญุณูู ุฑุณุงูุฉ ุฎุทุฃ ูููุฉ ุงูุณุฑ

## ๐ฏ **ููููุฉ ุนูู ุงููุธุงู ุงูุขู:**

### ุฅูุบุงุก ุงููุงุชูุฑุฉ (Cancel Invoice):
1. ุงููุณุชุฎุฏู ูุถุบุท "Cancel Invoice / ุฅูุบุงุก ุงููุงุชูุฑุฉ"
2. ูุธูุฑ ูุฑุจุน ุญูุงุฑ ูุฅุฏุฎุงู ูููุฉ ุงูุณุฑ
3. ุฅุฐุง ุฃุฏุฎู **1991** โ ูุชู ุฅูุบุงุก ุงููุงุชูุฑุฉ
4. ุฅุฐุง ุฃุฏุฎู ูููุฉ ุณุฑ ุฎุงุทุฆุฉ โ ูุธูุฑ "ูููุฉ ุงูุณุฑ ุบูุฑ ุตุญูุญุฉ"

### ุญุฐู ุงููุงุชูุฑุฉ (Delete Invoice):
1. ุงููุณุชุฎุฏู ูุถุบุท "Delete / ุญุฐู" ูู ุฌุฏูู ุงูููุงุชูุฑ
2. ูุธูุฑ ุชุฃููุฏ ุงูุญุฐู
3. ูุธูุฑ ูุฑุจุน ุญูุงุฑ ูุฅุฏุฎุงู ูููุฉ ุงูุณุฑ
4. ุฅุฐุง ุฃุฏุฎู **1991** โ ูุชู ุญุฐู ุงููุงุชูุฑุฉ
5. ุฅุฐุง ุฃุฏุฎู ูููุฉ ุณุฑ ุฎุงุทุฆุฉ โ ูุธูุฑ "ูููุฉ ุงูุณุฑ ุบูุฑ ุตุญูุญุฉ"

### ุนุฑุถ ุงูุฎุตู:
1. **ูู ุดุงุดุฉ ุงููุจูุนุงุช**: ูุธูุฑ ุงูุฎุตู ูู ุงูููุช ุงููุนูู ุฃุซูุงุก ุฅุฏุฎุงู ุงููุณุจุฉ
2. **ูู ุฌุฏูู ุงูููุงุชูุฑ**: ุนููุฏ ูููุตู ูุธูุฑ ูููุฉ ุงูุฎุตู
3. **ูู ุงูุฅูุตุงู ุงููุทุจูุน**: ูุธูุฑ ุงูุฎุตู ุจููู ุฃุญูุฑ ูุน ุนูุงูุฉ ูุงูุต

## ๐ง **ุงููููุงุช ุงูููุญุฏุซุฉ:**

1. **app.py**:
   - `api_sales_void_check()` - ูููุฉ ุณุฑ ุซุงุจุชุฉ 1991
   - `delete_sales_invoice()` - ุญูุงูุฉ ูููุฉ ุงูุณุฑ

2. **templates/print/receipt.html**:
   - ุชุญุณูู ุนุฑุถ ุงูุฎุตู ูู ุงูุฅูุตุงู

3. **templates/sales.html**:
   - ุฅุถุงูุฉ ุนููุฏ ุงูุฎุตู ูู ุงูุฌุฏูู
   - ุชุญุฏูุซ JavaScript ูุทูุจ ูููุฉ ุงูุณุฑ

4. **templates/sales_table_invoice.html**:
   - ุชุญุณูู ุฑุณุงูุฉ ุฎุทุฃ ูููุฉ ุงูุณุฑ

## ๐งช **ุงุฎุชุจุงุฑ ุงููุธุงู:**

### ุงุฎุชุจุงุฑ ุงูุฎุตู:
1. ุงุฐูุจ ุฅูู ุตูุญุฉ ุงููุจูุนุงุช
2. ุฃูุดุฆ ูุงุชูุฑุฉ ุฌุฏูุฏุฉ
3. ุฃุถู ูุฌุจุงุช
4. ุฃุฏุฎู ูุณุจุฉ ุฎุตู (ูุซู 10%)
5. ุชุญูู ูู ุธููุฑ ุงูุฎุตู ูู ุงูููุฎุต
6. ุงุทุจุน ุงููุงุชูุฑุฉ ูุชุญูู ูู ุธููุฑ ุงูุฎุตู

### ุงุฎุชุจุงุฑ ูููุฉ ุงูุณุฑ:
1. **ุฅูุบุงุก ุงููุงุชูุฑุฉ**: ุงุถุบุท "Cancel Invoice" ูุฃุฏุฎู 1991
2. **ุญุฐู ุงููุงุชูุฑุฉ**: ุงุถุบุท "Delete" ูุฃุฏุฎู 1991
3. **ูููุฉ ุณุฑ ุฎุงุทุฆุฉ**: ุฌุฑุจ ุฃู ุฑูู ุขุฎุฑ ูุชุฃูุฏ ูู ุธููุฑ ุฑุณุงูุฉ ุงูุฎุทุฃ

## ๐ **ุงููุชูุฌุฉ ุงูููุงุฆูุฉ:**

โ **ุงูุฎุตู ูุธูุฑ ุจูุถูุญ** ูู ุฌููุน ุฃุฌุฒุงุก ุงููุธุงู  
โ **ุญูุงูุฉ ูุงููุฉ ุจูููุฉ ุงูุณุฑ 1991** ูุฅูุบุงุก ูุญุฐู ุงูููุงุชูุฑ  
โ **ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ** ุจุงููุบุชูู ุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ  
โ **ุชุฌุฑุจุฉ ูุณุชุฎุฏู ูุญุณูุฉ** ูุน ุชุฃููุฏุงุช ูุงุถุญุฉ
